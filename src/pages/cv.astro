---
import Layout from '@/layouts/Layout.astro'
import { experiences, education, skills, publications } from '../data/cv'
import CvTimeline from '@/components/ui/CvTimeline.astro'

import type { Experience, Education, Publication } from '../types/cv'
import List from '@/components/ui/List.astro'
import PublicationsList from '@/components/ui/PublicationsList.astro'

let orderdExperiences: Experience[] = []
let orderdEducations: Education[] = []
let orderedPublications: Publication[] = []

const orderElement = <T extends { time: string }>(a: T, b: T) => {
  const presentValues = ['present', 'now', 'current', 'today']
  if (
    presentValues.includes(
      (a['time'] as string)?.split(' - ')[1]?.toLowerCase()
    )
  ) {
    // Si el segundo valor de "time" es "Present", lo coloca primero
    return -1
  }
  const dateA = new Date((a['time'] as string)?.split(' - ')[1])
  const dateB = new Date((b['time'] as string)?.split(' - ')[1])
  return dateB.getTime() - dateA.getTime()
}

if (experiences.length > 0) {
  orderdExperiences = experiences.sort((a, b) => orderElement(a, b))
}

if (education.length > 0) {
  orderdEducations = education.sort((a, b) => orderElement(a, b))
}

if (publications.length > 0) {
  orderedPublications = publications.sort((a, b) => orderElement(a, b))
}
---

<Layout>
  <!-- üßæ CV Section -->
  <section class="mb-12 text-center border-b pb-12">
    <h2 class="text-2xl font-bold mb-4">Curriculum Vitae</h2>
    <p class="mb-6 text-gray-700">
      Aqu√≠ puedes visualizar o descargar mi CV completo en formato PDF.
    </p>

    <div class="flex justify-center">
      <iframe
        src="/assets/CV.pdf"
        width="80%"
        height="600px"
        class="border rounded-lg shadow-lg"
        title="CV PDF"
      ></iframe>
    </div>

    <div class="mt-6">
      <a
        href="/assets/CV.pdf"
        download
        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
      >
        Descargar CV
      </a>
    </div>
  </section>

  {
    orderdEducations.length > 0 && (
      <section class='mb-12'>
        <h2 class='text-2xl font-bold mb-6 border-b pb-2'>
          Education
        </h2>
        <CvTimeline elements={orderdEducations} colored={true} />
      </section>
    )
  }

  {
    orderdExperiences.length > 0 && (
      <section class='mb-12'>
        <h2 class='text-2xl font-bold mb-6 border-b pb-2'>
          Experiences
        </h2>
        <CvTimeline elements={orderdExperiences} colored={true} />
      </section>
    )
  }

  {
    orderedPublications.length > 0 && (
      <section class='mb-12'>
        <h2 class='text-2xl font-bold mb-6 border-b pb-2'>
          Last publications
        </h2>
        <PublicationsList elements={orderedPublications}/>
      </section>
    )
  }

  {
    skills.length > 0 && (
      <section class='mb-12'>
        <List listTitle='Skills' listItems={skills}/>
      </section>
    )
  }
</Layout>
